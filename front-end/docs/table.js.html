<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: table.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: table.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Inicializar o tabulator sem dados.
 */
let tabledata = [{ Message: "Dados ainda não inseridos" }];
let table = new Tabulator("#HorarioPrincipal", {
  data: tabledata,
  layout: "fitDataFill",
  pagination: "local",
  paginationSize: 10,
  paginationSizeSelector: [5, 10, 20, 40],
  movableColumns: false,
  autoColumns: true,
});

const EMPTY_DATA = "";
/**
 * Inicializar o Filter Toggle Button no paginator da tabela
 */
let paginators = document.getElementsByClassName("tabulator-paginator");
let filterToggleButton = document.createElement("button");
filterToggleButton.className = "tabulator-filter-toggle-button";

/**
 * Convert a "dd/mm/yyyy" string into a Date object
 *
 * Alternatively, if dd/mm/yy is passed, 1900's will be assumed for yy higher than the last two digits of the current year (+2) and 2000's otherwise
 * @param {string} dateString
 * @returns {Date} date object
 */
function dateStringFormatCToDate(dateString) {
  let dateParts = dateString.split("/");
  if (dateParts.length &lt; 3) return null;

  const year =
    dateParts[2].length == 4
      ? dateParts[2]
      : dateParts[2] > String(new Date().getYear() + 1900 + 2).slice(2)
      ? "19" + dateParts[2]
      : "20" + dateParts[2];
  return new Date(year + "/" + dateParts[1] + "/" + dateParts[0]);
}

/**
 * Calculate the week number since the beggining of the year.
 *
 * @param {Date} date The date to check for.
 * @param {int} firstDayOfTheWeek (optional) 0 for Sunday, 1 for Monday,...,6 for Saturday.
 * @returns {int} int The number of the week.
 */
function getWeekNumber(date, firstDayOfTheWeek = 1) {
  if (date === null) return EMPTY_DATA;

  const firstDayOfTheYear = new Date(date.getFullYear(), 0, 1); //January 1st of the same year as date

  var weekStartOffset = firstDayOfTheYear.getDay() - firstDayOfTheWeek;
  weekStartOffset += weekStartOffset &lt; 0 ? 7 : 0;

  const daysElapsedThisYear = Math.ceil(
    Math.abs(date - firstDayOfTheYear) / (1000 * 60 * 60 * 24)
  ); //Days since january 1st

  const correctedDay = daysElapsedThisYear + weekStartOffset;

  const weekNumber = Math.floor(correctedDay / 7) + 1;

  return weekNumber;
}

/**
 * Temporarilly returns a static vallue working for the 2022-2023 academic year.
 *
 * @param {Any} tableData
 * @returns {{ firstSemesterStart: Date, firstSemesterFinish: Date,secondSemesterStart: Date,secondSemesterFinish: Date}}
 */
function calculateSemesters(tableData) {
  // Semester Beginning dates for 2023/24
  return {
    firstSemesterStart: new Date(2022, 8, 1),
    firstSemesterFinish: new Date(2023, 0, 28),
    secondSemesterStart: new Date(2023, 0, 30),
    secondSemesterFinish: new Date(2023, 6, 1),
  };

  // TODO - Make Semesters calculation dynamic
  // const ucs = [];
  // tableData.forEach((value) => {
  //   const found = ucs.find((v) => {
  //     return value["uc"] == v["uc"] &amp;&amp; value["curso"] == v["curso"];
  //   });
  //   if (found) {
  //     a = dateStringFormatCToDate(value.data);
  //     if (a &lt; found.firstDate) {
  //       found.firstDate = a;
  //     }
  //     if (a > found.lastDate) {
  //       found.lastDate = a;
  //     }
  //   } else {
  //     ucs.push({
  //       curso: value["curso"],
  //       uc: value["uc"],
  //       firstDate: dateStringFormatCToDate(value["data"]),
  //       lastDate: dateStringFormatCToDate(value["data"]),
  //     });
  //   }
  // });

  // console.log(ucs);
  // const cursos = new Set(
  //   ucs.map((v) => {
  //     return v.curso;
  //   })
  // );
  // console.log(cursos);

  // const output = {};

  // function calculateSemestersPerCourse(ucs) {
  //   console.log("ucs: ", ucs);
  //   const firstClass = ucs.reduce((previous, next) => {
  //     return previous.firstDate &lt; next.firstDate ? previous : next;
  //   }, (initialValue = ucs[0]));
  //   const lastClass = ucs.reduce((previous, next) => {
  //     return previous.lastDate > next.lastDate ? previous : next;
  //   }, ucs[0]);
  //   console.log("fc", firstClass, "lc", lastClass);
  //   const semesters = []; //[{ucs:["DIAM,PISID,ES"],firstDate:...,lastDate:...},...]
  //   function addClass() {
  //     function intercepts() {}
  //   }
  //   return { firstClass: new Date(), lastClass: new Date() };
  // }

  // cursos.forEach((value) => {
  //   console.log("curso:", value);
  //   const curso = ucs.filter((v) => {
  //     return v.curso == value;
  //   }); //tem apenas as UCs de um curso
  //   console.log("curso", curso);
  //   calculateSemestersPerCourse(curso);
  // });

  // const firstSemesterStart = tableData[0]["data"];
  // const secondSemesterStart = tableData[1]["data"];
  // return {
  //   firstSemesterStart: firstSemesterStart,
  //   secondSemesterStart: secondSemesterStart,
  //   firstSemesterFinish: firstSemesterFinish,
  //   secondSemesterFinish: secondSemesterFinish,
  // };
}

const {
  firstSemesterStart: semester1Start,
  secondSemesterStart: semester2Start,
} = calculateSemesters(tabledata);

/**
 * Calculate the week number since the beggining of the current semester.
 *
 * @param {Date} date The date to check for.
 * @param {Date} firstSemesterStart beggining date for the first semester (usually September)
 * @param {Date} secondSemesterStart beggining date for the second semester (usually February)
 * @returns {int} int The number of the semester's week.
 */
function getSemesterWeekNumber(
  date,
  firstSemesterStart = semester1Start,
  secondSemesterStart = semester2Start
) {
  if (date === null) return EMPTY_DATA;

  const semesterStart =
    date &lt; secondSemesterStart ? firstSemesterStart : secondSemesterStart;
  const weekNumberOfSemesterStart = getWeekNumber(semesterStart);
  const weekNumberOfDate = getWeekNumber(date);
  return weekNumberOfDate - weekNumberOfSemesterStart + 1;
}

/**
 * Atualizar os dados no Tabulator consoante o ficheiro .CSV formatado:
 * [{...},{...}, {...}, ...]
 *
 * @param {FormatedCsvFile} file
 */
export function setData(file) {
  tabledata = file;
  addSemanasColumns();

  table = new Tabulator("#HorarioPrincipal", {
    headerFilterPlaceholder: "Filtrar por",
    data: tabledata,
    layout: "fitDataFill",
    pagination: "local",
    paginationSize: 10,
    paginationSizeSelector: [5, 10, 20, 40],
    movableColumns: false,
    autoColumns: true,
    autoColumnsDefinitions: function (definitions) {
      // Adicionar Filtros no Tabulator
      definitions.forEach((column) => {
        column.headerFilter = true;
      });
      return definitions;
    },
  });

  renderFilterProps();
}

// function addSemanasHeaders(file) {
//   return file.map((row) => {
//     row.semana_do_ano = 1;
//     row.semana_do_semestre = 1;
//     return row;
//   });
// }

/**
 * Adiciona os filtros no tabela e desliga-os para não aparecerem no ecrã(aparecem por default).
 */
function renderFilterProps() {
  for (let i = 0; i &lt; paginators.length; i++) {
    paginators.item(i).prepend(filterToggleButton);
    filterToggleButton.addEventListener("click", () => toggleFilter());
  }

  let horario = document.getElementById("HorarioPrincipal");
  horario.setAttribute("filters", "off");
}

/**
 * If the following tabledata has attribute "Data da aula" adds week numbers to every row from table,
 * else skips completly this function.
 */
function addSemanasColumns() {
  tabledata.forEach((row) => {
    let dateObject;
    try {
      dateObject = dateStringFormatCToDate(row["Data da aula"]);
    } catch (error) {
      return;
    }
    row["Semana do Ano"] = getWeekNumber(dateObject);
    row["Semana do Semestre"] = getSemesterWeekNumber(dateObject);
  });
}

/**
 * Função que liga/desliga os filtros.
 */
function toggleFilter() {
  let table = document.getElementById("HorarioPrincipal");
  let toggled = table.getAttribute("filters");
  if (toggled == null || toggled == "off") {
    table.setAttribute("filters", "on");
  } else {
    table.setAttribute("filters", "off");
  }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Init.html">Init</a></li><li><a href="module-UploadCSV.html">UploadCSV</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addSemanasColumns">addSemanasColumns</a></li><li><a href="global.html#calculateSemesters">calculateSemesters</a></li><li><a href="global.html#dateStringFormatCToDate">dateStringFormatCToDate</a></li><li><a href="global.html#getSemesterWeekNumber">getSemesterWeekNumber</a></li><li><a href="global.html#getWeekNumber">getWeekNumber</a></li><li><a href="global.html#paginators">paginators</a></li><li><a href="global.html#renderFilterProps">renderFilterProps</a></li><li><a href="global.html#setData">setData</a></li><li><a href="global.html#tabledata">tabledata</a></li><li><a href="global.html#toggleFilter">toggleFilter</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Mar 17 2024 16:01:07 GMT+0000 (Hora padrão da Europa Ocidental)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
